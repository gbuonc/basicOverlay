/* Basic Overlay 0.8 ==============================================
 * Updated: 17/10/2012
 *
 * Author: Gianluca Buoncompagni
 * URL: http://gianlucabuoncompagni.net
 * Required files: jQuery 1.7+ Core
 * License: MIT License (http://www.opensource.org/licenses/mit-license.php)
 */
var basicOverlay=function(e,t,n){"use strict";var r={overlayId:"basicOverlay",overlayColor:"#000000",overlayOpacity:.5,closable:!0,externalPage:"",content:"#modal",before:null,after:null,onClose:null,afterClose:null},i="fixed",s=".bso-overlay",o=".bso-content",u=".overlay-close",a={options:r,init:function(r){var u=e("body").outerHeight(),f=e(t).height();e("body").append('<div id="'+r.overlayId+'"><div class="bso-overlay" /><div class="bso-content" /></div>'),e("#"+r.overlayId).find(s).css({width:"100%",height:f>u?f:u+"px","z-index":"9998",background:r.overlayColor,position:i,top:"0",left:"0","text-align":"center",filter:"alpha(opacity="+r.overlayOpacity*100+")","-khtml-opacity":r.overlayOpacity,"-webkit-opacity":r.overlayOpacity,"-moz-opacity":r.overlayOpacity,opacity:r.overlayOpacity}),e("#"+r.overlayId).find(o).css({"z-index":"9999",position:i,top:f/2+"px",left:"0",right:"0",height:"1px","text-align":"center",overflow:"visible",opacity:0}),r.closable===!0&&(e(s).on("click",function(){a.close(r.overlayId)}),e(n).on("keyup",function(e){e.keyCode===27&&a.close(r.overlayId)})),r.externalPage.length>1?this.loadRemote(r):r.content.length>1&&r.content.substr(0,1)==="#"?this.loadInPage(r):this.loadRemote(r)},loadInPage:function(t){if(e(t.content).length!==0){var n=t.content,r=e(t.content).clone().appendTo(o).show().outerHeight();a.show(n,r,t)}else a.close(t.overlayId)},loadRemote:function(t){var n=t.content,r=t.externalPage+" "+n;e(o).load(t.externalPage,function(r,i,s){var u=e(o).find(n).length;if(i==="success"&&u!==0){var f=e(o).find(n).outerHeight();a.show(n,f,t)}else a.close(t.overlayId)})},show:function(t,n,r){e(u).on("click",function(){a.close(r.overlayId)}),e(o).find(t).css({margin:"0 auto",position:"relative",top:-1*Math.abs(n/2)+"px",display:"block"}),a.current=t,a.onClose=r.onClose,a.afterClose=r.afterClose,r.before?(e(o).css({opacity:"1"}),r.before(e(o).find(t),function(){r.after&&r.after(e(o).find(t))})):e(o).animate({opacity:"1"},500,function(){r.after&&r.after(e(o).find(t))})},open:function(t){t=e.extend({},a.config,t),t=e.extend({},a.options,t),a.init(t)},close:function(t){var n=e(o).find(a.current);a.onClose?a.onClose(n,function(){a.removeHtml(t)}):a.removeHtml(t)},removeHtml:function(t){var r=e(o).find(a.current);e(s+", "+o+" ,#"+t).remove(),a.afterClose&&a.afterClose(r),e(s).off("click"),e(n).off("keyup"),e(u).off("click"),a.current=null,a.onClose=null,a.afterClose=null}};return e.fn.basicOverlay=function(t){return t=t||{},this.each(function(){var n,r=e(this).attr("href"),i=e(this).attr("data-overlay-modal");if(r&&r.length>1){n=i||(r.substr(0,1)==="#"?r:!1);var s=r.substr(0,1)!=="#"?r:!1}else n=i;if(t.content||n)t.content=t.content||n;if(t.externalPage||s)t.externalPage=t.externalPage||s;e(this).on("click",function(){return a.open(t),!1})})},a}(jQuery,window,document)